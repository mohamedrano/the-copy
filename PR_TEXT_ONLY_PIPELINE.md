# Pull Request: Text-Only AI Pipeline + Station Coupling + Per-Station Export + UI Labels

## ๐ฏ ุงููุฏู

ุฅุนุงุฏุฉ ุจูุงุก ูุธุงู ุงูุชุญููู ุงูุฏุฑุงูู ููุนูู ุจุดูู ูุงูู ุนูู **ุงููุตูุต ููุท**ุ ูุน:
- ุฅูุบุงุก ุฃู ุงูุชุฑุงุถุงุช JSON ููุงุฆููุง
- ุฑุจุท ุงููุญุทุงุช ุชุณูุณูููุง ูุชุนุชูุฏ ุนูู ูุฎุฑุฌุงุช ุจุนุถูุง
- ุชูููุฑ ูุงุฌูุฉ ุนุฑุถ ูุชุตุฏูุฑ ููู ูุญุทุฉ
- ุชุญุฏูุซ ุนูุงููู ูุชุณููุงุช ุงููุงุฌูุฉ

## ๐ ููุฎุต ุงูุชุบููุฑุงุช

### 1. ุทุจูุฉ AI ูุตูุฉ ูุญุถุฉ (`gemini-core.ts`)
- โ **ุญุฐู ูุงูู** ูุฃู ุฏูุงู `parseJsonLenient` ุฃู `JSON.parse`
- โ ูุงุฌูุฉ ูุงุญุฏุฉ ูุตูุฉ: `callGeminiText(opts): Promise<string>`
- โ ููุงุฐุฌ 2.5 ุญุตุฑููุง: `gemini-2.5-flash-lite`, `gemini-2.5-flash`, `gemini-2.5-pro`
- โ Throttling ููุญุฏ: 6s / 10s / 15s ุญุณุจ ุงููููุฐุฌ
- โ ุญุฏ ุชูููุฒ ููุญุฏ: `48192` ูุฌููุน ุงูููุงุฐุฌ
- โ ุฃุฏูุงุช ุขููุฉ: `toText()`, `safeSub()`, `safeSplit()`

### 2. ููุณู ุงููุญุทุงุช ุงูุชุณูุณูู (`pipeline-orchestrator.ts`)
ููู ุฌุฏูุฏ ูุฏูุฑ ุงููุญุทุงุช ุจุงูุชุณูุณู:

```
ุงููุต โ ุณ1 โ ุณ2(ุชุนุชูุฏ ุณ1) โ ุณ3(ุณ1ุุณ2) โ ุณ4(ุณ1-3) โ ุณ5(ุณ2-4) โ ุณ6(ุณ1-5) โ ุณ7(ุณ1-6)
```

ูู ูุญุทุฉ:
- ุชุณุชูุจู ูุตูุง ูู ุงููุญุทุงุช ุงูุณุงุจูุฉ
- ุชููุชุฌ ูุตูุง ููุท (ูุง JSON)
- ุชุณุชุฎุฏู `safeSub/safeSplit` ูููุนุงูุฌุฉ ุงูุขููุฉ

### 3. ูุงุฌูุฉ ุงููุญุทุงุช ุงููุญุฏูุซุฉ

#### ุจุทุงูุงุช ุงููุญุทุงุช (`station-card.tsx`):
- ุนุฑุถ ููุฎุต (300 ุญุฑู) ูู ูุฎุฑุฌุงุช ูู ูุญุทุฉ
- ุฒุฑ **ุนุฑุถ** โ ููุชุญ Modal ุจุงูุชูุฑูุฑ ุงููุงูู
- ุฒุฑ **ุชุตุฏูุฑ** โ ูุญูุธ ุชูุฑูุฑ ุงููุญุทุฉ `.txt`
- ุงุณุชุฎุฏุงู `toText()` ูุฌููุน ุงููุฎุฑุฌุงุช

#### ุฎุท ุงูุฃูุงุจูุจ (`stations-pipeline.tsx`):
- ุฒุฑ **ุชุตุฏูุฑ ุงูุชูุฑูุฑ ุงูููุงุฆู ุงูุดุงูู**
- ูุฌูุน ุณ1-7 ุจุชุฑุชูุจ ูุงุถุญ ูู ููู ูุงุญุฏ
- ูุธูุฑ ููุท ุนูุฏ ุงูุชูุงู ุฌููุน ุงููุญุทุงุช

### 4. ุฅุฒุงูุฉ ุณุฌูุงุช JSON

**ูุจู:**
```typescript
logger.warn("Gemini response did not contain valid JSON payload...");
console.warn("[Gemini Service] Response was not valid JSON...");
```

**ุจุนุฏ:**
```typescript
logger.info("[AI] text generated");
console.log("[AI] text generated");
```

### 5. ุชุญุฏูุซ ุงูุชุณููุงุช

#### ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ:
| ูุจู | ุจุนุฏ |
|-----|-----|
| ูุญุฑุฑ ุงููุตูุต | **ูุชุงุจุฉ** |
| ุชุญููู ุฏุฑุงูู | **ุชุทููุฑ** |
| ุชุญููู ูุนูู | **ุชุญููู** |
| ุนุตู ุฐููู | **ุงููุฑุดุฉ** |

#### ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ:
- ุชุจุฏูู ูููุฉ "ุชุญููู" โ "ุชุทููุฑ" ูู ุงูุนูุงููู

## ๐๏ธ ุงููููุงุช ุงูููุนุฏููุฉ

### ูููุงุช ุฌููุฑูุฉ:
- โ `frontend/src/lib/ai/gemini-core.ts` - ุทุจูุฉ AI ูุตูุฉ ูุญุถุฉ
- โ `frontend/src/lib/ai/pipeline-orchestrator.ts` - **ููู ุฌุฏูุฏ**
- โ `frontend/src/components/station-card.tsx` - ุนุฑุถ/ุชุตุฏูุฑ ููู ูุญุทุฉ
- โ `frontend/src/components/stations-pipeline.tsx` - ุชุตุฏูุฑ ููุงุฆู ุดุงูู
- โ `frontend/src/app/actions.ts` - `runTextPipeline()` ุฌุฏูุฏ

### ูููุงุช ุซุงูููุฉ:
- โ `frontend/src/components/main-nav.tsx` - ุชุณููุงุช ูุญุฏุซุฉ
- โ `frontend/src/app/page.tsx` - ุชุจุฏูู ุงูุนูุงููู
- โ `frontend/src/lib/ai/gemini-service.ts` - ุฅุฒุงูุฉ ุชุญุฐูุฑุงุช JSON
- โ `frontend/src/lib/ai/stations/gemini-service.ts` - ููุงุฐุฌ 2.5 ููุท

### ุชูุซูู:
- โ `frontend/TEXT_ONLY_PIPELINE.md` - **ูุซุงุฆู ุดุงููุฉ**

## ๐จ ุณูุงุณุฉ ุงูููุงุฐุฌ

| ุงููุญุทุฉ | ุงููููุฐุฌ | ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ | ุงูุชุฃุฎูุฑ |
|--------|---------|--------------|---------|
| 1 - ุงูุชุญููู ุงูุฃุณุงุณู | `gemini-2.5-flash-lite` | 0.3 | 6s |
| 2 - ุงูููุงูููู | `gemini-2.5-flash` | 0.3 | 10s |
| 3 - ุจูุงุก ุงูุดุจูุฉ | `gemini-2.5-flash-lite` | 0.3 | 6s |
| 4 - ุงูููุงุกุฉ | `gemini-2.5-flash-lite` | 0.3 | 6s |
| 5 - ุงูุฏููุงูููู | `gemini-2.5-flash-lite` | 0.3 | 6s |
| 6 - ุงูุชุดุฎูุต | `gemini-2.5-flash` | 0.3 | 10s |
| 7 - ุงูููุงุฆู | `gemini-2.5-pro` | 0.2 | 15s |

## โ ุงุฎุชุจุงุฑุงุช ุงููุจูู

- [x] ูุง ููุฌุฏ ุฃู Log ูุญุชูู ุนูู `JSON` ุฃู `payload`
- [x] ูู ุจุทุงูุฉ ูุญุทุฉ ุชุญุชูู ุนูู ุฒุฑูู: **ุนุฑุถ** ู**ุชุตุฏูุฑ**
- [x] ุฒุฑ **ุนุฑุถ** ููุชุญ Modal ุจุงููุต ุงููุงูู
- [x] ุฒุฑ **ุชุตุฏูุฑ** ููุฒูู ููู `.txt` ูููุญุทุฉ
- [x] ุฒุฑ **ุชุตุฏูุฑ ุงูุชูุฑูุฑ ุงูููุงุฆู** ูุฌูุน ุณ1-7 ุจุชุฑุชูุจูุง
- [x] ุตูุญุฉ `/analysis/deep` ุชุนุฑุถ ุฌููุน ุงููุญุทุงุช 1-7
- [x] ูุง ุงุณุชุซูุงุกุงุช React: "Objects are not valid as React child"
- [x] ุงูุจูุงุก ููุฌุญ ุจุฏูู ุฃุฎุทุงุก TypeScript

## ๐จ ุงูุจูุงุก ูุงูุงุฎุชุจุงุฑ

```bash
# ุงูุชุซุจูุช
pnpm -C frontend install

# ุงูุจูุงุก (ูุฌุญ โ)
pnpm -C frontend build

# ุงูุชุดุบูู
pnpm -C frontend dev -p 9002
```

**ูุชูุฌุฉ ุงูุจูุงุก:**
```
โ Compiled successfully
โ Generating static pages (11/11)
Route (app)                    Size  First Load JS
โ โ /                          5.54 kB    111 kB
โ โ /analysis/deep             1.55 kB    103 kB
โ โ /editor                    1.31 kB    103 kB
```

## ๐ ุงูููููุชุงุช

```
3b8e069 docs: add comprehensive text-only pipeline documentation
76327a5 fix(ts): resolve TypeScript compilation errors
a847349 fix(ui): render all stations consistently using text-only outputs
7d55f10 feat(i18n): rename sidebar labels and swap wording on home
25febbc chore(log): remove JSON-related logs; use text-only logs
060011e chore(ai): stationโmodel policy (2.5 only) + stable temperatures
c6275e5 feat(ui): per-station view/export + final report export
7336916 feat(pipeline): enforce sequential station coupling over text-only IO
05d2eb3 feat(ai): text-only core; remove all JSON parsing and warnings
```

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. โ ูุฑุงุฌุนุฉ ูุฐุง ุงูู PR
2. โณ ุงุฎุชุจุงุฑ ุดุงูู ูู ุจูุฆุฉ ุงูุชุทููุฑ
3. โณ ุฏูุฌ ูุน `main`
4. โณ ูุดุฑ ุฅูู ุงูุฅูุชุงุฌ

## ๐ ุงููุซุงุฆู

ุฑุงุฌุน `frontend/TEXT_ONLY_PIPELINE.md` ููุชูุงุตูู ุงููุงููุฉ.

## โ๏ธ Breaking Changes

### ูุง ููุฌุฏ Breaking Changes ูููุณุชุฎุฏู ุงูููุงุฆู
- ุงููุงุฌูุฉ ุชุจุฏู ูุชุนูู ุจุดูู ูุดุงุจู
- ุงูุชุณููุงุช ูุญุฏุซุฉ ููู ุงููุณุงุฑุงุช ูู ุชุชุบูุฑ
- ุงููุฎุฑุฌุงุช ุฃูุถู (ูุตูุต ูุงุถุญุฉ ุจุฏูุงู ูู JSON)

### ูููุทูุฑูู:
- `callGemini()` ุงุณุชูุจุฏูุช ุจู `callGeminiText()`
- `runFullPipeline()` ูุง ุชุฒุงู ุชุนูู (ููุชูุงูู)
- `runTextPipeline()` ุฌุฏูุฏ ูููุญุทุงุช ุงููุตูุฉ

## ๐ ุงููุฑุงุฌุนุฉ ุงููุทููุจุฉ

ููุฑุฌู ุงูุชุฑููุฒ ุนูู:
- โ ุฌูุฏุฉ ูุฎุฑุฌุงุช ุงููุญุทุงุช ุงููุตูุฉ
- โ ูุธุงุฆู ุงูุนุฑุถ ูุงูุชุตุฏูุฑ
- โ ุงูุชุณููุงุช ุงูุฌุฏูุฏุฉ (ููุงุณุจุฉุ)
- โ ุงูุฃุฏุงุก (Throttling ูุงููุ)

---

**ุงููุฑุน:** `feat/no-json-ui-stations-coupling`  
**ุงูุญุฌู:** +800 ุฅุถุงูุฉุ -400 ุญุฐู  
**ุงููููุงุช:** 11 ููู ูุนุฏููุ 2 ููู ุฌุฏูุฏ